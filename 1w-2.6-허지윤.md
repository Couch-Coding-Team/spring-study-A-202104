## 2.6 ì¿¼ë¦¬ ë©”ì„œë“œ ê¸°ëŠ¥ê³¼ @Query

### 1. ì¿¼ë¦¬ ë©”ì„œë“œë€?

- ë©”ì„œë“œì˜ ì´ë¦„ ìì²´ê°€ ì¿¼ë¦¬ì˜ êµ¬ë¬¸ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ê¸°ëŠ¥
- docs: [link](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods)

[2. ì¿¼ë¦¬ ë©”ì„œë“œ ì¢…ë¥˜](https://www.notion.so/8653186f8c01476594878d180a5aa69a)

### Ex 1) Between ì„ ì‚¬ìš©í•œë‹¤ê³  í–ˆì„ ë•Œ

- **SQL ë¬¸ ì‚¬ìš©ì‹œ**

```sql
SELECT * FROM spring.tbl_memo
WHERE mno >= 5 AND mno <= 9
ORDER BY mno DESC
```

- **Spring Data JPA ì‚¬ìš©ì‹œ**

ğŸ‘‡ MemoRepository ì¸í„°í˜ì´ìŠ¤ì— ì¶”ê°€

```java
package org.zerock.ex2.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.zerock.ex2.entity.Memo;

import java.util.List;

public interface MemoRepository extends JpaRepository<Memo, Long>{
    List<Memo> findByMnoBetweenOrderByMnoDesc(Long from, Long to);
}
```

ğŸ‘‡ MemoRepositoryTests í´ë˜ìŠ¤ì— ì¶”ê°€

```java
package org.zerock.ex2.repository;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.zerock.ex2.entity.Memo;

import java.util.List;
import java.util.Optional;
import java.util.stream.IntStream;

@SpringBootTest
public class MemoRepositoryTests {
    @Autowired
    MemoRepository memoRepository;

    @Test
    public void testQueryMethods(){
        List<Memo> list = memoRepository.findByMnoBetweenOrderByMnoDesc(5L, 9L);
        for (Memo memo : list){
            System.out.println(memo);
        }
    }
}
```

- **ê²°ê³¼**

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e3b0abdf-f18b-49a6-b1e4-f70d31193fbc/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e3b0abdf-f18b-49a6-b1e4-f70d31193fbc/Untitled.png)

### Ex 2) ì¿¼ë¦¬ ë©”ì„œë“œ + Pageable

### ì™œ í•„ìš”í•œê°€?

- Ex 1) ì—ì„œì™€ ê°™ì´ 'OrderBy' ê°€ ë“¤ì–´ê°€ë©´ ë©”ì„œë“œ ì´ë¦„ì´ ê¸¸ì–´ì ¸ì„œ í˜¼ë™í•˜ê¸°ê°€ ì‰¬ì›Œì§. ê·¸ë˜ì„œ Pageable íŒŒë¼ë¯¸í„°ë¥¼ ê°™ì´ ê²°í•©í•´ì„œ ì¢€ ë” ê°„ëµí•œ ë©”ì„œë“œë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ì„œ í•„ìš”í•˜ë‹¤.

ğŸ‘‡ MemoRepository ì¸í„°í˜ì´ìŠ¤ì— ì¶”ê°€

```java
package org.zerock.ex2.repository;

import org.springframework.data.domain.Page;
import org.springframework.data.jpa.repository.JpaRepository;
import org.zerock.ex2.entity.Memo;

import java.awt.print.Pageable;
import java.util.List;

public interface MemoRepository extends JpaRepository<Memo, Long>{
    //    ê¸¸ê³  í—·ê°ˆë¦¼
    List<Memo> findByMnoBetweenOrderByMnoDesc(Long from, Long to);

    //    â­ï¸ ì§§ìŒ
    Page<Memo> findByMnoBetween(Long from, Long to, Pageable pageable);
}
```

ğŸ‘‡ MemoRepositoryTests í´ë˜ìŠ¤ì— ì¶”ê°€

```java
@Test
public void testQueryMethodWithPageable(){
    Pageable pageable = PageRequest.of(0, 4, Sort.by("mno").descending());
    Page<Memo> result = memoRepository.findByMnoBetween(1L, 7L, pageable);
    result.get().forEach(memo -> System.out.println(memo));
}
```

- **ê²°ê³¼**

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ae1be481-0020-40f6-ba95-cb3ce9226cb2/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ae1be481-0020-40f6-ba95-cb3ce9226cb2/Untitled.png)

### Ex 3) deleteByë¡œ ì‹œì‘í•˜ëŠ” ì‚­ì œì²˜ë¦¬

ğŸ‘‡ MemoRepository ì¸í„°í˜ì´ìŠ¤ì— ì¶”ê°€

```java
import org.springframework.data.domain.Page;
import org.springframework.data.jpa.repository.JpaRepository;
import org.zerock.ex2.entity.Memo;

import org.springframework.data.domain.Pageable;
import java.util.List;

public interface MemoRepository extends JpaRepository<Memo, Long>{

    //    delete
    void deleteMemoByMnoLessThan(Long num);
}
```

ğŸ‘‡ MemoRepositoryTests í´ë˜ìŠ¤ì— ì¶”ê°€

```java
		@Commit
    @Transactional
    @Test
    public void testDeleteQueryMethods(){
        memoRepository.deleteMemoByMnoLessThan(2L);
    }
```

@Transactional ì–´ë…¸í…Œì´ì…˜ í•„ìš”í•œ ì´ìœ ?

- deleteBy..ì˜ ê²½ìš° ìš°ì„  'select'ë¬¸ìœ¼ë¡œ í•´ë‹¹ ì—”í‹°í‹° ê°ì²´ë“¤ì„ ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ê³¼ ê° ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ëŠ” ì‘ì—…ì´ ê°™ì´ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸.



@Commit ì–´ë…¸í…Œì´ì…˜ í•„ìš”í•œ ì´ìœ ?

- ìµœì¢… ê²°ê³¼ë¥¼ ì»¤ë°‹í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©. ì´ë¥¼ ì ìš©í•˜ì§€ ì•Šìœ¼ë©´ deleteBy.. ê°€ ë¡¤ë°± ì²˜ë¦¬ë˜ì–´ì„œ ê²°ê³¼ê°€ ë°˜ì˜ë˜ì§€ ì•ŠìŒ.

ê·¸ëŸ°ë° deleteBy ëŠ” ì‹¤ì œ ê°œë°œì—ì„œ ë§ì´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•¨. ì™œ? SQL ì²˜ëŸ¼ í•œë²ˆì— ì‚­ì œê°€ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê° ì—”í‹°í‹° ê°ì²´ë¥¼ í•˜ë‚˜ì”© ì‚­ì œí•˜ê¸° ë•Œë¬¸!
